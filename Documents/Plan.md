# План автоматизации тестирования сервиса покупки туров через интернет-банк #

### Предусловия:

Корректными данными при заполнении полей ввода следует считать:

* Номер карты: цифровые символы, 16 шт., в формате **** **** **** ****
* Месяц: 01-12, но не ранее текущего месяца в случае, если указан текущий год
* Год: последние две цифры порядкового номера года, но не ранее текущего года, и не более 5ти лет от текущего года
* Владелец: буквы латинского алфавита(фамилия и имя)
* CVC/CVV: цифровые символы (3 шт.) 

 Карты, представленные для тестирования (файл data.json):
* 4444 4444 4444 4441, status APPROVED
* 4444 4444 4444 4442, status DECLINED


## 1. Перечень автоматизируемых сценариев

### UI-тесты
Позитивные сценарии(happy path):
1. Совершить покупку тура через кнопку "Купить" с главной страницы сервиса.

1.1 Успешная покупка при оплате картой с валидным номером и достаточным количеством средств на счете.  
Номер карты 4444 4444 4444 4441, остальные поля заполнены корректными значениями.
Ожидаемый результат: появилось всплывающее окно "Успешно. Операция одобрена Банком", 
в БД появилась запись со статусом APPROVED.  

   1.2 Покупка тура при оплате картой с валидным номером и недостаточным количеством средств на счете.  
   Номер карты 4444 4444 4444 4442, остальные поля заполнены корректными значениями. 
   Ожидаемый результат: появилось всплывающее окно "Ошибка! Банк отказал в проведении операции".   
   В БД появилась запись со статусом DECLINED.

2. Покупка тура через кнопку "Купить в кредит" с главной страницы сервиса.  

 2.1 Успешная покупка тура в кредит с помощью валидной карты, с достаточным кредитным лимитом.  
   Номер карты 4444 4444 4444 4441, остальные поля заполнены корректными значениями.   
   Ожидаемый результат: появляется уведомление "Успешно. Операция одобрена Банком".
   В БД появилась запись со статусом APPROVED.
 2.2 Покупка тура в кредит с помощью валидной карты, с недостаточным кредитным лимитом.  
 Номер карты 4444 4444 4444 4442, остальные поля заполнены корректными значениями.  
 Ожидаемый результат: появляется уведомление об ошибке "Ошибка! Банк отказал в проведении операции".  
 В БД появилась запись со статусом DECLINED.

### Негативные сценарии: ###

*Оплата тура по дебетовой карте:*

1. Оплата по несуществующей карте
   Номер карты 4444 4444 4444 4443, остальные поля заполнены корректными значениями.  
   Ожидаемый результат: появилось всплывающее окно "Ошибка! Банк отказал в проведении операции".

2. Оплата по несуществующей карте(поле Номер карты заполнено нулями)  
   Номер карты 0000 0000 0000 0000, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: появилось всплывающее окно "Ошибка! Банк отказал в проведении операции".

3. Оплата по карте, с незаполненым полем (Номер карты)
   Поле Номер карты оставить пустым, остальные поля заполнены корректными значениями.  
   Ожидаемый результат: под полем Номер карты появилось сообщение об ошибке "Поле обязательно для заполнения".

4. Оплата по карте, с невалидным номером  
   Номер карты 4444 4444 4444 44, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: под полем Номер карты появилось сообщение об ошибке "Неверный формат".

5. Оплата по карте с истекшим сроком действия (месяц)  
   Номер карты 4444 4444 4444 4441, указать предыдущий месяц, текущий год, остальные поля заполнены корректными значениями.  
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Неверно указан срок действия карты".

6. Оплата по карте, где в поле указан невалидный месяц  
   Номер карты 4444 4444 4444 4441, в поле Месяц указать 13, остальные поля заполнены корректными значениями  
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Неверно указан срок действия карты".

7. Оплата по карте, где поле Месяц указаны нули    
   Номер карты 4444 4444 4444 4441, в поле Месяц указать 00, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Неверный формат".

8. Оплата по карте, с незаполненым полем (месяц)   
   Номер карты 4444 4444 4444 4441, поле Месяц оставить пустым, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Поле обязательно для заполнения".

9. Оплата по карте с истекшим сроком действия (год)  
   Номер карты 4444 4444 4444 4441, указать предыдущий год, остальные поля заполнены корректными значениями.  
   Ожидаемый результат: под полем Год появилось сообщение об ошибке "Истёк срок действия карты".

10. Оплата по карте с незаполненым полем (год)    
    Номер карты 4444 4444 4444 4441, поле Год оставить пустым, остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем Год появилось сообщение об ошибке "Поле обязательно для заполнения".

11. Оплата по карте, где в поле указан невалидный год  
     Номер карты 4444 4444 4444 4441, в поле Год указать "последние две цифры текущего года + 6", остальные поля заполнены корректными значениями  
     Ожидаемый результат: под полем Год появилось сообщение об ошибке "Неверно указан срок действия карты".  

12. Оплата по карте, где указано некорректное значение в поле (Владелец)  
    Номер карты 4444 4444 4444 4441, в поле Владелец указать некорректные данные(например кириллицу или цифры), остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке.

13. Оплата по карте, где в поле Владелец указаны спецсимволы  
    Номер карты 4444 4444 4444 4441, в поле Владелец указать некорректные данные(спецсимволы), остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке.

14. Оплата по карте, где в поле Владелец указано только Имя или Фамилия.  
    Номер карты 4444 4444 4444 4441, в поле Владелец указать только имя или только фамилию, остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке.

15. Оплата по карте, с незаполненым полем (Владелец)    
    Номер карты 4444 4444 4444 4441, поле Владелец оставить пустым, остальные поля заполнены корректными значениями.      
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке "Поле обязательно для заполнения".

16. Оплата по карте, где указано некорректное значение в поле CVC/CVV  
    Номер карты 4444 4444 4444 4441, в поле CVC/CVV ввести 1 или 2 цифры, остальные поля заполнены корректными значениями.  
    Ожидаемый результат: под полем CVC/CVV появилось сообщение об ошибке "Неверный формат".

17. Оплата по карте, с незаполненым полем (CVC/CVV)    
    Номер карты 4444 4444 4444 4441, поле CVC/CVV оставить пустым, остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем CVC/CVV появилось сообщение об ошибке "Поле обязательно для заполнения".  

18. Оплата по карте, когда поле CVC/CVV заполнено нулями    
    Номер карты 4444 4444 4444 4441, в поле CVC/CVV ввести три ноля(000), остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем CVC/CVV появилось сообщение об ошибке "Неверный формат".

*Покупка тура в кредит:*

1. Покупка в кредит по несуществующей карте  
   Номер карты 4444 4444 4444 4443, остальные поля заполнены корректными значениями.   
   Ожидаемый результат: появилось всплывающее окно "Ошибка! Банк отказал в проведении операции".

2. Покупка в кредит по несуществующей карте (поле Номер карты заполнено нулями)    
   Номер карты 0000 0000 0000 0000, остальные поля заполнены корректными значениями.   
   Ожидаемый результат: появилось всплывающее окно "Ошибка! Банк отказал в проведении операции".

3. Покупка в кредит по карте, с невалидным номером  
   Номер карты 4444 4444 4444 44, остальные поля заполнены корректными значениями.  
   Ожидаемый результат: под полем Номер карты появилось сообщение об ошибке "Неверный формат".

4. Покупка в кредит по карте, с незаполненым полем (Номер карты) 
   Поле Номер карты оставить пустым, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: под полем Номер карты появилось сообщение об ошибке "Поле обязательно для заполнения".  

5. Покупка в кредит по карте с истекшим сроком действия (месяц)   
   Номер карты 4444 4444 4444 4441, указать предыдущий месяц, текущий год, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Неверно указан срок действия карты".

6. Покупка в кредит по карте, где в поле указан невалидный месяц     
   Номер карты 4444 4444 4444 4441, в поле Месяц указать 13, остальные поля заполнены корректными значениями.  
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Неверно указан срок действия карты".

7. Покупка в кредит по карте, где поле Месяц указаны нули    
   Номер карты 4444 4444 4444 4441, в поле Месяц указать 00, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Неверный формат".

8. Покупка в кредит по карте, с незаполненым полем (месяц)    
   Номер карты 4444 4444 4444 4441, поле Месяц оставить пустым, остальные поля заполнены корректными значениями.    
   Ожидаемый результат: под полем Месяц появилось сообщение об ошибке "Поле обязательно для заполнения".

9. Покупка в кредит по карте с истекшим сроком действия (год)  
   Номер карты 4444 4444 4444 4441, указать предыдущий год, остальные поля заполнены корректными значениями.  
   Ожидаемый результат: под полем Год появилось сообщение об ошибке "Истёк срок действия карты".

10. Покупка в кредит по карте, где в поле указан невалидный год  
    Номер карты 4444 4444 4444 4441, в поле Год указать "последние две цифры текущего года + 6", остальные поля заполнены корректными значениями.  
    Ожидаемый результат: под полем Год появилось сообщение об ошибке "Неверно указан срок действия карты".

11. Покупка в кредит по карте с незаполненым полем (год)    
    Номер карты 4444 4444 4444 4441, поле Год оставить пустым, остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем Год появилось сообщение об ошибке "Поле обязательно для заполнения".

12. Покупка в кредит по карте, где указано некорректное значение в поле Владелец  
    Номер карты 4444 4444 4444 4441, в поле Владелец указать некорректные данные(например кириллицу или цифры), остальные поля заполнены корректными значениями.  
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке.

13. Покупка в кредит по карте, с незаполненым полем (Владелец)      
    Номер карты 4444 4444 4444 4441, поле Владелец оставить пустым, остальные поля заполнены корректными значениями.        
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке "Поле обязательно для заполнения".

14. Покупка в кредит по карте, где в поле Владелец указано только Имя или Фамилия.    
    Номер карты 4444 4444 4444 4441, в поле Владелец указать только имя или только фамилию, остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке.

15. Покупка в кредит по карте, где в поле Владелец указаны спецсимволы  
    Номер карты 4444 4444 4444 4441, в поле Владелец указать некорректные данные(спецсимволы), остальные поля заполнены корректными значениями.    
    Ожидаемый результат: под полем Владелец появилось сообщение об ошибке.

16. Покупка в кредит по данным карты, где указано некорректное значение в поле CVC/CVV  
    Номер карты 4444 4444 4444 4441, в поле CVC/CVV ввести 1 или 2 цифры, остальные поля заполнены корректными значениями.  
    Ожидаемый результат: под полем CVC/CVV появилось сообщение об ошибке "Неверный формат".

17. Покупка в кредит по карте, с незаполненым полем (CVC/CVV)      
    Номер карты 4444 4444 4444 4441, поле CVC/CVV оставить пустым, остальные поля заполнены корректными значениями.      
    Ожидаемый результат: под полем CVC/CVV появилось сообщение об ошибке "Поле обязательно для заполнения".

18. Покупка в кредит по данным карты, когда в поле CVC/CVV введены нули
    Номер карты 4444 4444 4444 4441, в поле CVC/CVV ввести три ноля(000), остальные поля заполнены корректными значениями  
    Ожидаемый результат: под полем CVC/CVV появилось сообщение об ошибке "Неверный формат".

## API-тесты
Необходимо проверить, что при обращении к сервису через API он отдаёт те же данные что и при UI-тестах.
Для этого необходимы 4 теста, которые проверяют разные карты и статус этих карт в базе данных.

*Предусловия:*  
 Данные для карты со статусом APPROVED: Номер карты - 4444444444444441, Месяц - 01, Год - 23, Владелец - Tinkov Oleg, CVC/CVV - 123   
 Данные для карты со статусом DECLINED: Номер карты - 4444444444444442, Месяц - 02, Год - 23, Владелец - Tinkov Oleg, CVC/CVV - 123

Перечень сценариев:
1. При оплате по карте 4444444444444441 (обращение к http://localhost:8080/api/v1/pay) ответ сервера - код 200 OK, статус карты APPROVED
2. При оплате по карте 4444444444444442 (обращение к http://localhost:8080/api/v1/pay) ответ сервера - код 200 OK, статус карты DECLINED
3. При отправке заявки на кредит по карте 4444444444444441 (обращение к http://localhost:8080/api/v1/credit) ответ сервера - код 200 OK, статус карты APPROVED
4. При отправке заявки на кредит по карте 4444444444444442 (обращение к http://localhost:8080/api/v1/credit) ответ сервера - код 200 OK, статус карты DECLINED

# Перечень используемых инструментов с обоснованием выбора #
1. Java 11 - универсальный язык, позволяющий работать на всех ОС и различном оборудовании за счет виртуальной машины.
2.  IntelliJ IDEA CE - удобная среда разработки для различных языков, совместима с различными плагинами и возможностью их комбинирования и настройки.
3. Gradle - система сборки проекта. По сравнению с Maven, в Gradle проще подключать зависимости, быстрота сборки, гибкость системы, меньше кода.
4. JUnit 5 - тестовый фреймворк, совместимый с JVM, содержит необходимые аннотации и assert’ы
5. Selenide - фреймворк для автоматизированного тестирования веб-приложений на основе Selenium WebDriver. Подключение веб-драйвера происходит автоматически, проще написание тестов, чем при использовании Selenium.
6. Faker - система генерации случайных данных для тестов. Позволяет создать тестовые данные автоматически с учетом местоположения, чтобы не хардкодить их в методы.
7. Lombok - полезный плагин для создания аннотаций, сокращающих написание кода за счёт автоматически генерируемых конструкторов, getters/setters и пр.
8. Docker - ПО для автоматизации развёртывания и управления приложениями в средах с поддержкой контейнеризации. Нужен для развертывания виртуальных контейнеров и запуске в них баз данных MySQL и PostgreSQL, а также сервисов банка на NodeJS .
9. Allure - система репортинга. Для просмотра расширенного отчета о прохождении тестов. У Allure значительно больший функционал по сравнению с отчетом Gradle.
10. Git - система контроля версий. Удобство, возможность одновременной параллельной разработки, есть интеграция с IntelliJ IDEA.

# Перечень и описание возможных рисков при автоматизации #
* Из-за отсутствия ТЗ и какой-либо документации сложно понять, как должно работать приложение и какое поведение системы нужно считать багом, а какое "фичей";
* Технические сложности с настройкой Docker-compose.yml и SUT — возможные проблемы с подключением к БД, cложности c раздельным подключением тестов через БД MySQL и   PostgreSQL, SUT не запускается и т.п.;
* Использование сторонних библиотек и фреймворков может увеличивать риск возникновения технических проблем;
* Риск ошибиться при написании кода самих тестов и page object;
* Отсутствие test_id усложняет поиск и привязку к необходимым CSS-селекторам для Selenide при написании тестов;
* Если в будущем будет переделан дизайн сайта (либо будут изменены какие-то данные), то тесты перестанут работать.

# Интервальная оценка с учетом рисков (в часах) #
Настройка тестового окружения - 10;  
Написание и отладка автотестов - 72;  
Прогон автотестов - 10;  
Подготовка отчетной документации, баг-репортов - 12 часов;  
Запас в виде 48 часов на устранение замечаний и непредвиденные обстоятельства.

## План сдачи работ
Автоматизация - 10.12.2022  
Подготовка отчетов о тестировании - 14.12.2022